# random canvas fingerprint
randomcanvas.js application/javascript
(function() {
	const canvas = window.document.createElement('canvas')
	const sampleDataURI = canvas.toDataURL()
	const parameters = `${sampleDataURI.split(/[,]/)[0]},`
	const init = function(parameters, sampleDataURI) {
		return function() {
			const randomizedDataURI = sampleDataURI.split('').sort(() => 0.5-Math.random()).join('')
			console.warn('🐳 HTMLCanvasElement.toDataURL accessed')
			return parameters+randomizedDataURI
		}
	}
	const randomcanvas = init(parameters, sampleDataURI)
	//
	const inIframe = window !== window.parent
	const iframeCollection = document.getElementsByTagName('iframe')
	const flatten = arr => [].concat(...arr)
	const clean = arr => arr.filter(e => e === 0 || e)
	let insertedNodes = []
	const observer = new MutationObserver(mutations => {
		const addedNodes = mutations.filter(mutation => mutation.addedNodes.length).map(mutation => mutation.addedNodes)
		insertedNodes.push(addedNodes)
	})
	if (iframeCollection) {
		[...iframeCollection].forEarch(iframe = > observer.observe(iframe.contentDocument, { childList: true }))
	}
	if (inIframe) { console.log('In iFrame Window')}
	observer.observe(document, { childList: true })
	console.log(insertedNodes)
	//
	return Object.defineProperty(
		HTMLCanvasElement.prototype,
		'toDataURL', { 
			value: randomcanvas
		}
	)
})()
